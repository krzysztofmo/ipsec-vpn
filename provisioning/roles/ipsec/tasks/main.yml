---
- name: Install strongSwan
  apt:
    name: strongswan
    state: present

- name: Create configuration files for strongSwan
  template:
    src: "{{ item }}.j2"
    dest: /etc/{{ item }}
    owner: root
    group: root
    mode: 0600
  notify: restart strongswan
  with_items:
  - ipsec.secrets
  - strongswan.conf

- name: Create connection
  template:
    src: "{{ inventory_hostname }}.conf.j2"
    dest: /etc/ipsec.conf
    owner: root
    group: root
    mode: 0600
  notify: restart strongswan
